<div class="container mt-5">
	<div class="row justify-content-center">
		<div class="col-md-8 col-lg-6">
			<div class="card shadow">
				<div class="card-header bg-success text-white">
					<h3 class="mb-0">{{ isEditMode ? 'Editar Resultado' : 'Nuevo Resultado' }}</h3>
				</div>
				<div class="card-body">
					<form (ngSubmit)="onSubmit()" #resForm="ngForm">

						<div class="mb-3">
							<label for="paciente" class="form-label">Paciente</label>
							<select id="paciente" name="paciente" [(ngModel)]="resultado.paciente"
								[compareWith]="compareObjects" required class="form-select">
								<option [ngValue]="undefined">Seleccione un paciente</option>
								<option *ngFor="let user of users$ | async" [ngValue]="user">{{ user.username }} ({{
									user.email }})</option>
							</select>
						</div>

						<div class="mb-3">
							<label for="laboratorio" class="form-label">Laboratorio</label>
							<select id="laboratorio" name="laboratorio" [(ngModel)]="resultado.laboratorio"
								[compareWith]="compareObjects" required class="form-select">
								<option [ngValue]="undefined">Seleccione un laboratorio</option>
								<option *ngFor="let lab of laboratorios$ | async" [ngValue]="lab">{{ lab.nombre }}
								</option>
							</select>
						</div>

						<div class="mb-3">
							<label for="analisis" class="form-label">An√°lisis</label>
							<textarea id="analisis" name="analisis" [(ngModel)]="resultado.analisis" required
								class="form-control" rows="3"></textarea>
						</div>

						<div class="mb-3">
							<label for="fecha" class="form-label">Fecha</label>
							<input type="date" id="fecha" name="fecha" [(ngModel)]="resultado.fecha" required
								class="form-control">
						</div>

						<div *ngIf="error" class="alert alert-danger">
							{{ error }}
						</div>

						<div class="d-flex justify-content-end gap-2">
							<a routerLink="/resultados" class="btn btn-secondary">Cancelar</a>
							<button type="submit" [disabled]="!resForm.form.valid || loading" class="btn btn-success">
								{{ loading ? 'Guardando...' : 'Guardar' }}
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>